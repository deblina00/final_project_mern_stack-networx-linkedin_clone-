<%- include('partials/header') %>
<%- include('partials/sidebar') %>

<div class="main-content">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Users</h3>

    <form class="d-flex" id="user-search-form" method="GET" action="/users">
      <input class="form-control me-2" name="q" value="<%= q %>" placeholder="Search by name or email" />
      <button class="btn btn-primary">Search</button>
    </form>
  </div>

  <div class="card shadow p-3">
    <table class="table table-striped align-middle">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Created</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>

      <tbody id="user-table">
        <% users.forEach(user => { %>
          <tr id="user-<%= user._id %>">
            <td><%= user.f_name || "â€”" %></td>
            <td><%= user.email %></td>
            <td><%= new Date(user.createdAt).toLocaleString() %></td>
            <td class="text-end">
              <!-- Block / Unblock toggle -->
              <% const blocked = !!user.isBlocked; %>
              <button
                id="user-block-<%= user._id %>"
                class="btn btn-sm <%= blocked ? 'btn-warning' : 'btn-success' %> me-2"
                data-blocked="<%= blocked %>"
                onclick="toggleBlock('user','<%= user._id %>', this, true)"
              >
                <%= blocked ? 'Unblock' : 'Block' %>
              </button>

              <!-- Delete opens confirmation modal; comment route uses /users/:id DELETE -->
              <button class="btn btn-sm btn-danger" onclick="openDeleteModal({ url: '/users/<%= user._id %>', rowId: 'user-<%= user._id %>' })">
                Delete
              </button>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <nav class="mt-3">
    <ul class="pagination">
      <% for(let i=1;i<=pages;i++) { %>
        <li class="page-item <%= i===page ? 'active' : '' %>">
          <a class="page-link" href="/users?page=<%= i %>&q=<%= q %>"><%= i %></a>
        </li>
      <% } %>
    </ul>
  </nav>
</div>

<%- include('partials/footer') %>
